//
//  SDAppDelegate.m
//  sonicAPIClient
//
//  Created by Maik Mann on 23.10.12.
//  Copyright (c) 2012 Maik Mann. All rights reserved.
//

#import "SDAppDelegate.h"

@implementation SDAppDelegate

- (void)applicationDidFinishLaunching:(NSNotification *)aNotification
{
    
    NSString* accessID = @"a43d2e2e-817d-4602-b649-9858e959d8cc";
    NSString* $taskUrl = @"analyze/key";
    
   
    CFStringRef url = CFSTR("http://www.sonicapi.com");
    CFURLRef myURL = CFURLCreateWithString(kCFAllocatorDefault, url, NULL);
    CFStringRef requestMethod = CFSTR("GET");
    CFStringRef bodyString = CFSTR(""); // Usually used for POST data
    CFDataRef bodyData = CFStringCreateExternalRepresentation(kCFAllocatorDefault, bodyString, kCFStringEncodingUTF8, 0);
    CFStringRef headerFieldName = CFSTR("X-My-Favorite-Field");
    CFStringRef headerFieldValue = CFSTR("Dreams");
    
    CFHTTPMessageRef myRequest = CFHTTPMessageCreateRequest(kCFAllocatorDefault,requestMethod, myURL, kCFHTTPVersion1_1);
    CFHTTPMessageSetBody(myRequest, bodyData);
    CFHTTPMessageSetHeaderFieldValue(myRequest, headerFieldName, headerFieldValue);
    CFReadStreamRef myReadStream =CFReadStreamCreateForHTTPRequest(kCFAllocatorDefault, myRequest);
    CFReadStreamOpen(myReadStream);
    NSLog ( @"The current date and time is: %@", [NSDate date] );
    
    CFHTTPMessageRef myResponse =(CFHTTPMessageRef)CFReadStreamCopyProperty(myReadStream,kCFStreamPropertyHTTPResponseHeader);
    CFStringRef myStatusLine = CFHTTPMessageCopyResponseStatusLine(myResponse);
    NSLog(@"Response: %@", myStatusLine);
    UInt32 myErrCode = CFHTTPMessageGetResponseStatusCode(myResponse);
    NSLog(@"Response: %i", myErrCode);
    CFStringRef myMessageRequestCopy = CFHTTPMessageCopyRequestURL(myResponse);
    NSLog(@"Response: %@", myMessageRequestCopy);
    CFStringRef myMessageHeaderFieldCopy = CFHTTPMessageCopyHeaderFieldValue(myResponse);
    NSLog(@"Response: %@", myMessageHeaderFieldCopy);
    
}

@end
